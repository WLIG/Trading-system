# 实际工作环境部署指南

## 🎯 概述

本指南专门针对实际工作环境中的量化交易系统部署，包含生产级配置、安全措施、监控方案和运维最佳实践。

## 🏗️ 系统架构

### 推荐架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   负载均衡器     │    │   Web界面服务    │    │   数据库服务     │
│   (Nginx)       │────│   (Flask)       │────│  (PostgreSQL)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │              ┌─────────────────┐              │
         └──────────────│   交易核心服务   │──────────────┘
                        │ (Trading Engine) │
                        └─────────────────┘
                                 │
                        ┌─────────────────┐
                        │   通知服务       │
                        │ (Telegram Bot)  │
                        └─────────────────┘
```

## 🖥️ 服务器要求

### 最低配置
- **CPU**: 2核心 2.4GHz
- **内存**: 4GB RAM
- **存储**: 50GB SSD
- **网络**: 100Mbps带宽
- **操作系统**: Ubuntu 20.04 LTS 或更高版本

### 推荐配置
- **CPU**: 4核心 3.0GHz
- **内存**: 8GB RAM
- **存储**: 100GB SSD
- **网络**: 1Gbps带宽
- **操作系统**: Ubuntu 22.04 LTS

### 云服务器推荐
- **AWS**: t3.medium 或更高
- **阿里云**: ecs.c6.large 或更高
- **腾讯云**: S5.MEDIUM4 或更高
- **华为云**: c6.large.2 或更高

## 🔧 环境准备

### 1. 系统初始化

```bash
#!/bin/bash
# 系统初始化脚本

# 更新系统
sudo apt update && sudo apt upgrade -y

# 安装基础工具
sudo apt install -y \
    curl \
    wget \
    git \
    vim \
    htop \
    unzip \
    software-properties-common \
    apt-transport-https \
    ca-certificates \
    gnupg \
    lsb-release

# 设置时区
sudo timedatectl set-timezone Asia/Shanghai

# 配置防火墙
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 5000  # Flask应用端口

echo "✅ 系统初始化完成"
```

### 2. Python环境安装

```bash
#!/bin/bash
# Python环境安装脚本

# 安装Python 3.9+
sudo apt install -y python3 python3-pip python3-venv python3-dev

# 升级pip
python3 -m pip install --upgrade pip

# 安装系统级Python包
sudo apt install -y python3-setuptools python3-wheel

# 验证安装
python3 --version
pip3 --version

echo "✅ Python环境安装完成"
```

### 3. 数据库安装

```bash
#!/bin/bash
# PostgreSQL数据库安装脚本

# 安装PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# 启动并启用PostgreSQL服务
sudo systemctl start postgresql
sudo systemctl enable postgresql

# 创建数据库和用户
sudo -u postgres psql << EOF
CREATE DATABASE trading_system;
CREATE USER trading_user WITH ENCRYPTED PASSWORD 'secure_password_123';
GRANT ALL PRIVILEGES ON DATABASE trading_system TO trading_user;
ALTER USER trading_user CREATEDB;
\q
EOF

echo "✅ PostgreSQL数据库安装完成"
```

### 4. Redis安装（可选）

```bash
#!/bin/bash
# Redis缓存安装脚本

# 安装Redis
sudo apt install -y redis-server

# 配置Redis
sudo sed -i 's/supervised no/supervised systemd/' /etc/redis/redis.conf

# 启动并启用Redis服务
sudo systemctl restart redis.service
sudo systemctl enable redis

# 测试Redis
redis-cli ping

echo "✅ Redis安装完成"
```

## 📦 应用部署

### 1. 项目部署

```bash
#!/bin/bash
# 项目部署脚本

# 创建应用用户
sudo useradd -m -s /bin/bash trading
sudo usermod -aG sudo trading

# 切换到应用用户
sudo su - trading

# 创建项目目录
mkdir -p ~/trading_system
cd ~/trading_system

# 克隆项目（或上传文件）
# git clone https://github.com/your-repo/trading-system.git .

# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements_enhanced.txt

# 创建必要目录
mkdir -p logs data backups

echo "✅ 项目部署完成"
```

### 2. 配置文件设置

创建生产环境配置 `production.env`：

```bash
# 生产环境配置文件
# ================================================

# 应用模式
FLASK_ENV=production
DEBUG=False
TRADING_MODE=live

# 安全配置
SECRET_KEY=your_very_secure_secret_key_here_min_32_chars
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_secure_admin_password

# 币安API配置
BINANCE_API_KEY=your_production_binance_api_key
BINANCE_API_SECRET=your_production_binance_api_secret
USE_TESTNET=False

# Telegram Bot配置
TELEGRAM_ENABLED=True
TELEGRAM_BOT_TOKEN=your_production_telegram_bot_token
TELEGRAM_CHAT_ID=your_telegram_chat_id

# 数据库配置
DATABASE_URL=postgresql://trading_user:secure_password_123@localhost:5432/trading_system

# Redis配置（如果使用）
REDIS_URL=redis://localhost:6379/0

# 邮件配置
EMAIL_ENABLED=True
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
EMAIL_FROM=your_email@gmail.com
EMAIL_TO=alerts@yourcompany.com

# 日志配置
LOG_LEVEL=INFO
LOG_FILE=/home/trading/trading_system/logs/trading_system.log

# 性能配置
MAX_WORKERS=4
CACHE_DURATION=30

# 监控配置
ENABLE_METRICS=True
METRICS_PORT=8080
HEALTH_CHECK_INTERVAL=60

# 风险管理
MAX_DAILY_LOSS_PCT=0.05
MAX_DRAWDOWN_PCT=0.15
STOP_LOSS_PCT=0.02
TAKE_PROFIT_PCT=0.04
```

### 3. 数据库初始化

```python
# database_init.py
import os
import sys
from sqlalchemy import create_engine, text
from enhanced_config import TradingSystemConfig

def init_database():
    """初始化数据库"""
    config = TradingSystemConfig()
    db_url = config.database_config['database_url']
    
    engine = create_engine(db_url)
    
    # 创建表结构
    with engine.connect() as conn:
        # 交易记录表
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS trades (
                id SERIAL PRIMARY KEY,
                timestamp TIMESTAMP NOT NULL,
                symbol VARCHAR(20) NOT NULL,
                side VARCHAR(10) NOT NULL,
                quantity DECIMAL(20, 8) NOT NULL,
                price DECIMAL(20, 8) NOT NULL,
                value DECIMAL(20, 8) NOT NULL,
                commission DECIMAL(20, 8) NOT NULL,
                pnl DECIMAL(20, 8),
                strategy VARCHAR(50),
                signal_confidence DECIMAL(5, 4),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        # 信号记录表
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS signals (
                id SERIAL PRIMARY KEY,
                timestamp TIMESTAMP NOT NULL,
                symbol VARCHAR(20) NOT NULL,
                signal VARCHAR(10) NOT NULL,
                confidence DECIMAL(5, 4) NOT NULL,
                price DECIMAL(20, 8) NOT NULL,
                indicators JSONB,
                reason TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        # 性能记录表
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS performance (
                id SERIAL PRIMARY KEY,
                date DATE NOT NULL,
                total_value DECIMAL(20, 8) NOT NULL,
                daily_return DECIMAL(10, 6),
                cumulative_return DECIMAL(10, 6),
                drawdown DECIMAL(10, 6),
                trades_count INTEGER,
                win_rate DECIMAL(5, 4),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        # 系统日志表
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS system_logs (
                id SERIAL PRIMARY KEY,
                timestamp TIMESTAMP NOT NULL,
                level VARCHAR(10) NOT NULL,
                message TEXT NOT NULL,
                module VARCHAR(50),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        conn.commit()
    
    print("✅ 数据库初始化完成")

if __name__ == "__main__":
    init_database()
```

运行数据库初始化：
```bash
cd ~/trading_system
source venv/bin/activate
python database_init.py
```

## 🔒 安全配置

### 1. SSL证书配置

```bash
#!/bin/bash
# SSL证书安装脚本

# 安装Certbot
sudo apt install -y certbot python3-certbot-nginx

# 获取SSL证书（替换your-domain.com为实际域名）
sudo certbot --nginx -d your-domain.com

# 设置自动续期
sudo crontab -e
# 添加以下行：
# 0 12 * * * /usr/bin/certbot renew --quiet

echo "✅ SSL证书配置完成"
```

### 2. Nginx配置

创建 `/etc/nginx/sites-available/trading_system`：

```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # SSL配置
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # 安全头
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    # 主应用
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 静态文件
    location /static {
        alias /home/trading/trading_system/web/static;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 监控端点
    location /metrics {
        proxy_pass http://127.0.0.1:8080;
        allow 127.0.0.1;
        deny all;
    }
}
```

启用配置：
```bash
sudo ln -s /etc/nginx/sites-available/trading_system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 3. 防火墙配置

```bash
#!/bin/bash
# 防火墙配置脚本

# 重置防火墙规则
sudo ufw --force reset

# 默认策略
sudo ufw default deny incoming
sudo ufw default allow outgoing

# 允许SSH（限制IP范围）
sudo ufw allow from YOUR_IP_RANGE to any port 22

# 允许HTTP和HTTPS
sudo ufw allow 80
sudo ufw allow 443

# 允许数据库连接（仅本地）
sudo ufw allow from 127.0.0.1 to any port 5432

# 启用防火墙
sudo ufw enable

# 显示状态
sudo ufw status verbose

echo "✅ 防火墙配置完成"
```

## 🚀 服务配置

### 1. 系统服务配置

创建 `/etc/systemd/system/trading-system.service`：

```ini
[Unit]
Description=Enhanced Trading System
After=network.target postgresql.service
Wants=postgresql.service

[Service]
Type=simple
User=trading
Group=trading
WorkingDirectory=/home/trading/trading_system
Environment=PATH=/home/trading/trading_system/venv/bin
EnvironmentFile=/home/trading/trading_system/production.env
ExecStart=/home/trading/trading_system/venv/bin/python enhanced_trading_system.py
ExecReload=/bin/kill -HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true
Restart=always
RestartSec=10

# 安全配置
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/home/trading/trading_system/logs /home/trading/trading_system/data

[Install]
WantedBy=multi-user.target
```

### 2. Web服务配置

创建 `/etc/systemd/system/trading-web.service`：

```ini
[Unit]
Description=Trading System Web Interface
After=network.target trading-system.service
Wants=trading-system.service

[Service]
Type=simple
User=trading
Group=trading
WorkingDirectory=/home/trading/trading_system/web
Environment=PATH=/home/trading/trading_system/venv/bin
EnvironmentFile=/home/trading/trading_system/production.env
ExecStart=/home/trading/trading_system/venv/bin/python enhanced_app.py
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

### 3. 启动服务

```bash
# 重新加载systemd
sudo systemctl daemon-reload

# 启用服务
sudo systemctl enable trading-system
sudo systemctl enable trading-web

# 启动服务
sudo systemctl start trading-system
sudo systemctl start trading-web

# 检查状态
sudo systemctl status trading-system
sudo systemctl status trading-web
```

## 📊 监控和日志

### 1. 日志配置

创建 `logging_config.py`：

```python
import logging
import logging.handlers
import os
from datetime import datetime

def setup_logging():
    """配置生产环境日志"""
    
    # 创建日志目录
    log_dir = "/home/trading/trading_system/logs"
    os.makedirs(log_dir, exist_ok=True)
    
    # 配置根日志器
    root_logger = logging.getLogger()
    root_logger.setLevel(logging.INFO)
    
    # 文件处理器（按时间轮转）
    file_handler = logging.handlers.TimedRotatingFileHandler(
        filename=os.path.join(log_dir, "trading_system.log"),
        when="midnight",
        interval=1,
        backupCount=30,
        encoding="utf-8"
    )
    file_handler.setLevel(logging.INFO)
    
    # 错误文件处理器
    error_handler = logging.handlers.TimedRotatingFileHandler(
        filename=os.path.join(log_dir, "errors.log"),
        when="midnight",
        interval=1,
        backupCount=30,
        encoding="utf-8"
    )
    error_handler.setLevel(logging.ERROR)
    
    # 控制台处理器
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.WARNING)
    
    # 格式化器
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    file_handler.setFormatter(formatter)
    error_handler.setFormatter(formatter)
    console_handler.setFormatter(formatter)
    
    # 添加处理器
    root_logger.addHandler(file_handler)
    root_logger.addHandler(error_handler)
    root_logger.addHandler(console_handler)
    
    return root_logger
```

### 2. 系统监控脚本

创建 `system_monitor.py`：

```python
#!/usr/bin/env python3
import psutil
import time
import logging
import requests
import os
from datetime import datetime
from telegram_bot import TelegramBot

class SystemMonitor:
    def __init__(self):
        self.bot = TelegramBot(
            os.getenv('TELEGRAM_BOT_TOKEN'),
            os.getenv('TELEGRAM_CHAT_ID')
        )
        self.logger = logging.getLogger(__name__)
        
        # 阈值配置
        self.thresholds = {
            'cpu': 80.0,
            'memory': 80.0,
            'disk': 90.0,
            'load': 2.0
        }
        
        # 警报冷却时间（秒）
        self.alert_cooldown = 3600  # 1小时
        self.last_alerts = {}
    
    def check_system_resources(self):
        """检查系统资源"""
        # CPU使用率
        cpu_percent = psutil.cpu_percent(interval=1)
        
        # 内存使用率
        memory = psutil.virtual_memory()
        memory_percent = memory.percent
        
        # 磁盘使用率
        disk = psutil.disk_usage('/')
        disk_percent = disk.percent
        
        # 系统负载
        load_avg = psutil.getloadavg()[0]
        
        # 网络连接数
        connections = len(psutil.net_connections())
        
        return {
            'cpu': cpu_percent,
            'memory': memory_percent,
            'disk': disk_percent,
            'load': load_avg,
            'connections': connections,
            'timestamp': datetime.now()
        }
    
    def check_service_status(self, service_name):
        """检查服务状态"""
        try:
            import subprocess
            result = subprocess.run(
                ['systemctl', 'is-active', service_name],
                capture_output=True,
                text=True
            )
            return result.stdout.strip() == 'active'
        except:
            return False
    
    def send_alert(self, alert_type, message):
        """发送警报"""
        current_time = time.time()
        
        # 检查冷却时间
        if alert_type in self.last_alerts:
            if current_time - self.last_alerts[alert_type] < self.alert_cooldown:
                return
        
        # 发送警报
        self.bot.send_alert(alert_type, message, 'warning')
        self.last_alerts[alert_type] = current_time
        self.logger.warning(f"Alert sent: {alert_type} - {message}")
    
    def monitor_loop(self):
        """监控主循环"""
        self.logger.info("系统监控启动")
        
        while True:
            try:
                # 检查系统资源
                stats = self.check_system_resources()
                
                # CPU检查
                if stats['cpu'] > self.thresholds['cpu']:
                    self.send_alert(
                        'high_cpu',
                        f"CPU使用率过高: {stats['cpu']:.1f}%"
                    )
                
                # 内存检查
                if stats['memory'] > self.thresholds['memory']:
                    self.send_alert(
                        'high_memory',
                        f"内存使用率过高: {stats['memory']:.1f}%"
                    )
                
                # 磁盘检查
                if stats['disk'] > self.thresholds['disk']:
                    self.send_alert(
                        'high_disk',
                        f"磁盘使用率过高: {stats['disk']:.1f}%"
                    )
                
                # 系统负载检查
                if stats['load'] > self.thresholds['load']:
                    self.send_alert(
                        'high_load',
                        f"系统负载过高: {stats['load']:.2f}"
                    )
                
                # 检查关键服务
                services = ['trading-system', 'trading-web', 'postgresql', 'nginx']
                for service in services:
                    if not self.check_service_status(service):
                        self.send_alert(
                            f'service_down',
                            f"服务 {service} 已停止"
                        )
                
                # 记录统计信息
                self.logger.info(
                    f"System stats - CPU: {stats['cpu']:.1f}%, "
                    f"Memory: {stats['memory']:.1f}%, "
                    f"Disk: {stats['disk']:.1f}%, "
                    f"Load: {stats['load']:.2f}"
                )
                
                # 等待下次检查
                time.sleep(300)  # 5分钟
                
            except Exception as e:
                self.logger.error(f"监控循环错误: {e}")
                time.sleep(60)

if __name__ == "__main__":
    from logging_config import setup_logging
    setup_logging()
    
    monitor = SystemMonitor()
    monitor.monitor_loop()
```

### 3. 监控服务配置

创建 `/etc/systemd/system/trading-monitor.service`：

```ini
[Unit]
Description=Trading System Monitor
After=network.target

[Service]
Type=simple
User=trading
Group=trading
WorkingDirectory=/home/trading/trading_system
Environment=PATH=/home/trading/trading_system/venv/bin
EnvironmentFile=/home/trading/trading_system/production.env
ExecStart=/home/trading/trading_system/venv/bin/python system_monitor.py
Restart=always
RestartSec=30

[Install]
WantedBy=multi-user.target
```

## 🔄 备份和恢复

### 1. 数据库备份脚本

创建 `backup_database.sh`：

```bash
#!/bin/bash
# 数据库备份脚本

BACKUP_DIR="/home/trading/trading_system/backups"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="trading_system"
DB_USER="trading_user"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 数据库备份
pg_dump -h localhost -U $DB_USER -d $DB_NAME > $BACKUP_DIR/db_backup_$DATE.sql

# 压缩备份文件
gzip $BACKUP_DIR/db_backup_$DATE.sql

# 删除7天前的备份
find $BACKUP_DIR -name "db_backup_*.sql.gz" -mtime +7 -delete

# 发送备份完成通知
echo "数据库备份完成: db_backup_$DATE.sql.gz"
```

### 2. 配置文件备份

创建 `backup_config.sh`：

```bash
#!/bin/bash
# 配置文件备份脚本

BACKUP_DIR="/home/trading/trading_system/backups"
DATE=$(date +%Y%m%d_%H%M%S)
CONFIG_DIR="/home/trading/trading_system"

# 创建备份目录
mkdir -p $BACKUP_DIR/config

# 备份配置文件
cp $CONFIG_DIR/production.env $BACKUP_DIR/config/production.env_$DATE
cp $CONFIG_DIR/enhanced_config.py $BACKUP_DIR/config/enhanced_config.py_$DATE

# 备份系统服务文件
sudo cp /etc/systemd/system/trading-*.service $BACKUP_DIR/config/

# 备份Nginx配置
sudo cp /etc/nginx/sites-available/trading_system $BACKUP_DIR/config/nginx_$DATE

echo "配置文件备份完成"
```

### 3. 自动备份配置

添加到crontab：
```bash
# 编辑crontab
crontab -e

# 添加以下行：
# 每天凌晨2点备份数据库
0 2 * * * /home/trading/trading_system/backup_database.sh

# 每周日凌晨3点备份配置文件
0 3 * * 0 /home/trading/trading_system/backup_config.sh
```

## 🔧 运维操作

### 1. 常用运维命令

```bash
# 查看服务状态
sudo systemctl status trading-system
sudo systemctl status trading-web
sudo systemctl status trading-monitor

# 重启服务
sudo systemctl restart trading-system
sudo systemctl restart trading-web

# 查看日志
sudo journalctl -u trading-system -f
tail -f /home/trading/trading_system/logs/trading_system.log

# 查看系统资源
htop
df -h
free -h

# 查看网络连接
netstat -tulpn | grep :5000

# 查看进程
ps aux | grep python
```

### 2. 故障排除流程

```bash
#!/bin/bash
# 故障排除脚本

echo "=== 交易系统故障排除 ==="

# 1. 检查服务状态
echo "1. 检查服务状态..."
systemctl is-active trading-system
systemctl is-active trading-web
systemctl is-active postgresql
systemctl is-active nginx

# 2. 检查端口占用
echo "2. 检查端口占用..."
netstat -tulpn | grep :5000
netstat -tulpn | grep :5432

# 3. 检查磁盘空间
echo "3. 检查磁盘空间..."
df -h

# 4. 检查内存使用
echo "4. 检查内存使用..."
free -h

# 5. 检查最近的错误日志
echo "5. 检查最近的错误日志..."
tail -20 /home/trading/trading_system/logs/errors.log

# 6. 检查数据库连接
echo "6. 检查数据库连接..."
sudo -u postgres psql -c "SELECT version();"

# 7. 检查网络连接
echo "7. 检查网络连接..."
ping -c 3 api.binance.com
ping -c 3 api.telegram.org

echo "=== 故障排除完成 ==="
```

### 3. 性能优化

```bash
#!/bin/bash
# 性能优化脚本

echo "=== 系统性能优化 ==="

# 1. 清理日志文件
echo "1. 清理旧日志文件..."
find /home/trading/trading_system/logs -name "*.log.*" -mtime +30 -delete

# 2. 清理临时文件
echo "2. 清理临时文件..."
sudo apt autoremove -y
sudo apt autoclean

# 3. 优化数据库
echo "3. 优化数据库..."
sudo -u postgres psql trading_system -c "VACUUM ANALYZE;"

# 4. 重启服务（可选）
read -p "是否重启交易服务？(y/N): " restart
if [[ $restart =~ ^[Yy]$ ]]; then
    sudo systemctl restart trading-system
    sudo systemctl restart trading-web
fi

echo "=== 性能优化完成 ==="
```

## 📋 部署检查清单

### 部署前检查
- [ ] 服务器配置满足要求
- [ ] 域名DNS解析正确
- [ ] SSL证书已申请
- [ ] 币安API密钥已配置
- [ ] Telegram Bot已创建
- [ ] 数据库已安装配置

### 部署后检查
- [ ] 所有服务正常运行
- [ ] Web界面可正常访问
- [ ] Telegram通知功能正常
- [ ] 数据库连接正常
- [ ] 日志记录正常
- [ ] 监控系统正常
- [ ] 备份脚本正常
- [ ] 防火墙配置正确

### 安全检查
- [ ] 默认密码已修改
- [ ] 不必要的端口已关闭
- [ ] SSL证书有效
- [ ] 文件权限正确
- [ ] 敏感信息已加密
- [ ] 访问日志已启用

## 🚨 应急响应

### 1. 紧急停止交易

```bash
#!/bin/bash
# 紧急停止脚本

echo "🚨 紧急停止交易系统..."

# 停止交易服务
sudo systemctl stop trading-system

# 发送紧急通知
curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
     -d "chat_id=$TELEGRAM_CHAT_ID" \
     -d "text=🚨 紧急停止：交易系统已手动停止"

echo "✅ 交易系统已停止"
```

### 2. 快速恢复

```bash
#!/bin/bash
# 快速恢复脚本

echo "🔄 快速恢复交易系统..."

# 检查数据库
sudo systemctl start postgresql
sleep 5

# 启动交易服务
sudo systemctl start trading-system
sudo systemctl start trading-web

# 检查状态
if systemctl is-active --quiet trading-system; then
    echo "✅ 交易系统恢复成功"
    curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
         -d "chat_id=$TELEGRAM_CHAT_ID" \
         -d "text=✅ 恢复成功：交易系统已重新启动"
else
    echo "❌ 交易系统恢复失败"
    curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
         -d "chat_id=$TELEGRAM_CHAT_ID" \
         -d "text=❌ 恢复失败：交易系统启动异常"
fi
```

## 📞 技术支持

### 联系方式
- **技术支持邮箱**: support@yourcompany.com
- **紧急联系电话**: +86-xxx-xxxx-xxxx
- **Telegram群组**: @your_trading_support

### 常见问题
1. **服务无法启动**: 检查配置文件和日志
2. **数据库连接失败**: 检查数据库服务和连接参数
3. **Telegram通知失败**: 检查Bot Token和Chat ID
4. **API调用失败**: 检查网络连接和API密钥

---

**注意**: 本指南提供了完整的生产环境部署方案，请根据实际情况调整配置参数。在生产环境中使用前，请务必进行充分的测试。

