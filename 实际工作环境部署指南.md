# å®é™…å·¥ä½œç¯å¢ƒéƒ¨ç½²æŒ‡å—

## ğŸ¯ æ¦‚è¿°

æœ¬æŒ‡å—ä¸“é—¨é’ˆå¯¹å®é™…å·¥ä½œç¯å¢ƒä¸­çš„é‡åŒ–äº¤æ˜“ç³»ç»Ÿéƒ¨ç½²ï¼ŒåŒ…å«ç”Ÿäº§çº§é…ç½®ã€å®‰å…¨æªæ–½ã€ç›‘æ§æ–¹æ¡ˆå’Œè¿ç»´æœ€ä½³å®è·µã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ¨èæ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   è´Ÿè½½å‡è¡¡å™¨     â”‚    â”‚   Webç•Œé¢æœåŠ¡    â”‚    â”‚   æ•°æ®åº“æœåŠ¡     â”‚
â”‚   (Nginx)       â”‚â”€â”€â”€â”€â”‚   (Flask)       â”‚â”€â”€â”€â”€â”‚  (PostgreSQL)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   äº¤æ˜“æ ¸å¿ƒæœåŠ¡   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ (Trading Engine) â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   é€šçŸ¥æœåŠ¡       â”‚
                        â”‚ (Telegram Bot)  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ–¥ï¸ æœåŠ¡å™¨è¦æ±‚

### æœ€ä½é…ç½®
- **CPU**: 2æ ¸å¿ƒ 2.4GHz
- **å†…å­˜**: 4GB RAM
- **å­˜å‚¨**: 50GB SSD
- **ç½‘ç»œ**: 100Mbpså¸¦å®½
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 20.04 LTS æˆ–æ›´é«˜ç‰ˆæœ¬

### æ¨èé…ç½®
- **CPU**: 4æ ¸å¿ƒ 3.0GHz
- **å†…å­˜**: 8GB RAM
- **å­˜å‚¨**: 100GB SSD
- **ç½‘ç»œ**: 1Gbpså¸¦å®½
- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04 LTS

### äº‘æœåŠ¡å™¨æ¨è
- **AWS**: t3.medium æˆ–æ›´é«˜
- **é˜¿é‡Œäº‘**: ecs.c6.large æˆ–æ›´é«˜
- **è…¾è®¯äº‘**: S5.MEDIUM4 æˆ–æ›´é«˜
- **åä¸ºäº‘**: c6.large.2 æˆ–æ›´é«˜

## ğŸ”§ ç¯å¢ƒå‡†å¤‡

### 1. ç³»ç»Ÿåˆå§‹åŒ–

```bash
#!/bin/bash
# ç³»ç»Ÿåˆå§‹åŒ–è„šæœ¬

# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
sudo apt install -y \
    curl \
    wget \
    git \
    vim \
    htop \
    unzip \
    software-properties-common \
    apt-transport-https \
    ca-certificates \
    gnupg \
    lsb-release

# è®¾ç½®æ—¶åŒº
sudo timedatectl set-timezone Asia/Shanghai

# é…ç½®é˜²ç«å¢™
sudo ufw enable
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
sudo ufw allow 5000  # Flaskåº”ç”¨ç«¯å£

echo "âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ"
```

### 2. Pythonç¯å¢ƒå®‰è£…

```bash
#!/bin/bash
# Pythonç¯å¢ƒå®‰è£…è„šæœ¬

# å®‰è£…Python 3.9+
sudo apt install -y python3 python3-pip python3-venv python3-dev

# å‡çº§pip
python3 -m pip install --upgrade pip

# å®‰è£…ç³»ç»Ÿçº§PythonåŒ…
sudo apt install -y python3-setuptools python3-wheel

# éªŒè¯å®‰è£…
python3 --version
pip3 --version

echo "âœ… Pythonç¯å¢ƒå®‰è£…å®Œæˆ"
```

### 3. æ•°æ®åº“å®‰è£…

```bash
#!/bin/bash
# PostgreSQLæ•°æ®åº“å®‰è£…è„šæœ¬

# å®‰è£…PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# å¯åŠ¨å¹¶å¯ç”¨PostgreSQLæœåŠ¡
sudo systemctl start postgresql
sudo systemctl enable postgresql

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo -u postgres psql << EOF
CREATE DATABASE trading_system;
CREATE USER trading_user WITH ENCRYPTED PASSWORD 'secure_password_123';
GRANT ALL PRIVILEGES ON DATABASE trading_system TO trading_user;
ALTER USER trading_user CREATEDB;
\q
EOF

echo "âœ… PostgreSQLæ•°æ®åº“å®‰è£…å®Œæˆ"
```

### 4. Rediså®‰è£…ï¼ˆå¯é€‰ï¼‰

```bash
#!/bin/bash
# Redisç¼“å­˜å®‰è£…è„šæœ¬

# å®‰è£…Redis
sudo apt install -y redis-server

# é…ç½®Redis
sudo sed -i 's/supervised no/supervised systemd/' /etc/redis/redis.conf

# å¯åŠ¨å¹¶å¯ç”¨RedisæœåŠ¡
sudo systemctl restart redis.service
sudo systemctl enable redis

# æµ‹è¯•Redis
redis-cli ping

echo "âœ… Rediså®‰è£…å®Œæˆ"
```

## ğŸ“¦ åº”ç”¨éƒ¨ç½²

### 1. é¡¹ç›®éƒ¨ç½²

```bash
#!/bin/bash
# é¡¹ç›®éƒ¨ç½²è„šæœ¬

# åˆ›å»ºåº”ç”¨ç”¨æˆ·
sudo useradd -m -s /bin/bash trading
sudo usermod -aG sudo trading

# åˆ‡æ¢åˆ°åº”ç”¨ç”¨æˆ·
sudo su - trading

# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir -p ~/trading_system
cd ~/trading_system

# å…‹éš†é¡¹ç›®ï¼ˆæˆ–ä¸Šä¼ æ–‡ä»¶ï¼‰
# git clone https://github.com/your-repo/trading-system.git .

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements_enhanced.txt

# åˆ›å»ºå¿…è¦ç›®å½•
mkdir -p logs data backups

echo "âœ… é¡¹ç›®éƒ¨ç½²å®Œæˆ"
```

### 2. é…ç½®æ–‡ä»¶è®¾ç½®

åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½® `production.env`ï¼š

```bash
# ç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
# ================================================

# åº”ç”¨æ¨¡å¼
FLASK_ENV=production
DEBUG=False
TRADING_MODE=live

# å®‰å…¨é…ç½®
SECRET_KEY=your_very_secure_secret_key_here_min_32_chars
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_secure_admin_password

# å¸å®‰APIé…ç½®
BINANCE_API_KEY=your_production_binance_api_key
BINANCE_API_SECRET=your_production_binance_api_secret
USE_TESTNET=False

# Telegram Boté…ç½®
TELEGRAM_ENABLED=True
TELEGRAM_BOT_TOKEN=your_production_telegram_bot_token
TELEGRAM_CHAT_ID=your_telegram_chat_id

# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://trading_user:secure_password_123@localhost:5432/trading_system

# Redisé…ç½®ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
REDIS_URL=redis://localhost:6379/0

# é‚®ä»¶é…ç½®
EMAIL_ENABLED=True
EMAIL_SMTP_SERVER=smtp.gmail.com
EMAIL_SMTP_PORT=587
EMAIL_USERNAME=your_email@gmail.com
EMAIL_PASSWORD=your_app_password
EMAIL_FROM=your_email@gmail.com
EMAIL_TO=alerts@yourcompany.com

# æ—¥å¿—é…ç½®
LOG_LEVEL=INFO
LOG_FILE=/home/trading/trading_system/logs/trading_system.log

# æ€§èƒ½é…ç½®
MAX_WORKERS=4
CACHE_DURATION=30

# ç›‘æ§é…ç½®
ENABLE_METRICS=True
METRICS_PORT=8080
HEALTH_CHECK_INTERVAL=60

# é£é™©ç®¡ç†
MAX_DAILY_LOSS_PCT=0.05
MAX_DRAWDOWN_PCT=0.15
STOP_LOSS_PCT=0.02
TAKE_PROFIT_PCT=0.04
```

### 3. æ•°æ®åº“åˆå§‹åŒ–

```python
# database_init.py
import os
import sys
from sqlalchemy import create_engine, text
from enhanced_config import TradingSystemConfig

def init_database():
    """åˆå§‹åŒ–æ•°æ®åº“"""
    config = TradingSystemConfig()
    db_url = config.database_config['database_url']
    
    engine = create_engine(db_url)
    
    # åˆ›å»ºè¡¨ç»“æ„
    with engine.connect() as conn:
        # äº¤æ˜“è®°å½•è¡¨
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS trades (
                id SERIAL PRIMARY KEY,
                timestamp TIMESTAMP NOT NULL,
                symbol VARCHAR(20) NOT NULL,
                side VARCHAR(10) NOT NULL,
                quantity DECIMAL(20, 8) NOT NULL,
                price DECIMAL(20, 8) NOT NULL,
                value DECIMAL(20, 8) NOT NULL,
                commission DECIMAL(20, 8) NOT NULL,
                pnl DECIMAL(20, 8),
                strategy VARCHAR(50),
                signal_confidence DECIMAL(5, 4),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        # ä¿¡å·è®°å½•è¡¨
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS signals (
                id SERIAL PRIMARY KEY,
                timestamp TIMESTAMP NOT NULL,
                symbol VARCHAR(20) NOT NULL,
                signal VARCHAR(10) NOT NULL,
                confidence DECIMAL(5, 4) NOT NULL,
                price DECIMAL(20, 8) NOT NULL,
                indicators JSONB,
                reason TEXT,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        # æ€§èƒ½è®°å½•è¡¨
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS performance (
                id SERIAL PRIMARY KEY,
                date DATE NOT NULL,
                total_value DECIMAL(20, 8) NOT NULL,
                daily_return DECIMAL(10, 6),
                cumulative_return DECIMAL(10, 6),
                drawdown DECIMAL(10, 6),
                trades_count INTEGER,
                win_rate DECIMAL(5, 4),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        # ç³»ç»Ÿæ—¥å¿—è¡¨
        conn.execute(text("""
            CREATE TABLE IF NOT EXISTS system_logs (
                id SERIAL PRIMARY KEY,
                timestamp TIMESTAMP NOT NULL,
                level VARCHAR(10) NOT NULL,
                message TEXT NOT NULL,
                module VARCHAR(50),
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        """))
        
        conn.commit()
    
    print("âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ")

if __name__ == "__main__":
    init_database()
```

è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–ï¼š
```bash
cd ~/trading_system
source venv/bin/activate
python database_init.py
```

## ğŸ”’ å®‰å…¨é…ç½®

### 1. SSLè¯ä¹¦é…ç½®

```bash
#!/bin/bash
# SSLè¯ä¹¦å®‰è£…è„šæœ¬

# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx

# è·å–SSLè¯ä¹¦ï¼ˆæ›¿æ¢your-domain.comä¸ºå®é™…åŸŸåï¼‰
sudo certbot --nginx -d your-domain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
# 0 12 * * * /usr/bin/certbot renew --quiet

echo "âœ… SSLè¯ä¹¦é…ç½®å®Œæˆ"
```

### 2. Nginxé…ç½®

åˆ›å»º `/etc/nginx/sites-available/trading_system`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;

    # SSLé…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # å®‰å…¨å¤´
    add_header X-Frame-Options DENY;
    add_header X-Content-Type-Options nosniff;
    add_header X-XSS-Protection "1; mode=block";
    add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";

    # ä¸»åº”ç”¨
    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™æ€æ–‡ä»¶
    location /static {
        alias /home/trading/trading_system/web/static;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # ç›‘æ§ç«¯ç‚¹
    location /metrics {
        proxy_pass http://127.0.0.1:8080;
        allow 127.0.0.1;
        deny all;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/trading_system /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 3. é˜²ç«å¢™é…ç½®

```bash
#!/bin/bash
# é˜²ç«å¢™é…ç½®è„šæœ¬

# é‡ç½®é˜²ç«å¢™è§„åˆ™
sudo ufw --force reset

# é»˜è®¤ç­–ç•¥
sudo ufw default deny incoming
sudo ufw default allow outgoing

# å…è®¸SSHï¼ˆé™åˆ¶IPèŒƒå›´ï¼‰
sudo ufw allow from YOUR_IP_RANGE to any port 22

# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80
sudo ufw allow 443

# å…è®¸æ•°æ®åº“è¿æ¥ï¼ˆä»…æœ¬åœ°ï¼‰
sudo ufw allow from 127.0.0.1 to any port 5432

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æ˜¾ç¤ºçŠ¶æ€
sudo ufw status verbose

echo "âœ… é˜²ç«å¢™é…ç½®å®Œæˆ"
```

## ğŸš€ æœåŠ¡é…ç½®

### 1. ç³»ç»ŸæœåŠ¡é…ç½®

åˆ›å»º `/etc/systemd/system/trading-system.service`ï¼š

```ini
[Unit]
Description=Enhanced Trading System
After=network.target postgresql.service
Wants=postgresql.service

[Service]
Type=simple
User=trading
Group=trading
WorkingDirectory=/home/trading/trading_system
Environment=PATH=/home/trading/trading_system/venv/bin
EnvironmentFile=/home/trading/trading_system/production.env
ExecStart=/home/trading/trading_system/venv/bin/python enhanced_trading_system.py
ExecReload=/bin/kill -HUP $MAINPID
KillMode=mixed
TimeoutStopSec=5
PrivateTmp=true
Restart=always
RestartSec=10

# å®‰å…¨é…ç½®
NoNewPrivileges=true
ProtectSystem=strict
ProtectHome=true
ReadWritePaths=/home/trading/trading_system/logs /home/trading/trading_system/data

[Install]
WantedBy=multi-user.target
```

### 2. WebæœåŠ¡é…ç½®

åˆ›å»º `/etc/systemd/system/trading-web.service`ï¼š

```ini
[Unit]
Description=Trading System Web Interface
After=network.target trading-system.service
Wants=trading-system.service

[Service]
Type=simple
User=trading
Group=trading
WorkingDirectory=/home/trading/trading_system/web
Environment=PATH=/home/trading/trading_system/venv/bin
EnvironmentFile=/home/trading/trading_system/production.env
ExecStart=/home/trading/trading_system/venv/bin/python enhanced_app.py
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# é‡æ–°åŠ è½½systemd
sudo systemctl daemon-reload

# å¯ç”¨æœåŠ¡
sudo systemctl enable trading-system
sudo systemctl enable trading-web

# å¯åŠ¨æœåŠ¡
sudo systemctl start trading-system
sudo systemctl start trading-web

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status trading-system
sudo systemctl status trading-web
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. æ—¥å¿—é…ç½®

åˆ›å»º `logging_config.py`ï¼š

```python
import logging
import logging.handlers
import os
from datetime import datetime

def setup_logging():
    """é…ç½®ç”Ÿäº§ç¯å¢ƒæ—¥å¿—"""
    
    # åˆ›å»ºæ—¥å¿—ç›®å½•
    log_dir = "/home/trading/trading_system/logs"
    os.makedirs(log_dir, exist_ok=True)
    
    # é…ç½®æ ¹æ—¥å¿—å™¨
    root_logger = logging.getLogger()
    root_logger.setLevel(logging.INFO)
    
    # æ–‡ä»¶å¤„ç†å™¨ï¼ˆæŒ‰æ—¶é—´è½®è½¬ï¼‰
    file_handler = logging.handlers.TimedRotatingFileHandler(
        filename=os.path.join(log_dir, "trading_system.log"),
        when="midnight",
        interval=1,
        backupCount=30,
        encoding="utf-8"
    )
    file_handler.setLevel(logging.INFO)
    
    # é”™è¯¯æ–‡ä»¶å¤„ç†å™¨
    error_handler = logging.handlers.TimedRotatingFileHandler(
        filename=os.path.join(log_dir, "errors.log"),
        when="midnight",
        interval=1,
        backupCount=30,
        encoding="utf-8"
    )
    error_handler.setLevel(logging.ERROR)
    
    # æ§åˆ¶å°å¤„ç†å™¨
    console_handler = logging.StreamHandler()
    console_handler.setLevel(logging.WARNING)
    
    # æ ¼å¼åŒ–å™¨
    formatter = logging.Formatter(
        '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
    )
    
    file_handler.setFormatter(formatter)
    error_handler.setFormatter(formatter)
    console_handler.setFormatter(formatter)
    
    # æ·»åŠ å¤„ç†å™¨
    root_logger.addHandler(file_handler)
    root_logger.addHandler(error_handler)
    root_logger.addHandler(console_handler)
    
    return root_logger
```

### 2. ç³»ç»Ÿç›‘æ§è„šæœ¬

åˆ›å»º `system_monitor.py`ï¼š

```python
#!/usr/bin/env python3
import psutil
import time
import logging
import requests
import os
from datetime import datetime
from telegram_bot import TelegramBot

class SystemMonitor:
    def __init__(self):
        self.bot = TelegramBot(
            os.getenv('TELEGRAM_BOT_TOKEN'),
            os.getenv('TELEGRAM_CHAT_ID')
        )
        self.logger = logging.getLogger(__name__)
        
        # é˜ˆå€¼é…ç½®
        self.thresholds = {
            'cpu': 80.0,
            'memory': 80.0,
            'disk': 90.0,
            'load': 2.0
        }
        
        # è­¦æŠ¥å†·å´æ—¶é—´ï¼ˆç§’ï¼‰
        self.alert_cooldown = 3600  # 1å°æ—¶
        self.last_alerts = {}
    
    def check_system_resources(self):
        """æ£€æŸ¥ç³»ç»Ÿèµ„æº"""
        # CPUä½¿ç”¨ç‡
        cpu_percent = psutil.cpu_percent(interval=1)
        
        # å†…å­˜ä½¿ç”¨ç‡
        memory = psutil.virtual_memory()
        memory_percent = memory.percent
        
        # ç£ç›˜ä½¿ç”¨ç‡
        disk = psutil.disk_usage('/')
        disk_percent = disk.percent
        
        # ç³»ç»Ÿè´Ÿè½½
        load_avg = psutil.getloadavg()[0]
        
        # ç½‘ç»œè¿æ¥æ•°
        connections = len(psutil.net_connections())
        
        return {
            'cpu': cpu_percent,
            'memory': memory_percent,
            'disk': disk_percent,
            'load': load_avg,
            'connections': connections,
            'timestamp': datetime.now()
        }
    
    def check_service_status(self, service_name):
        """æ£€æŸ¥æœåŠ¡çŠ¶æ€"""
        try:
            import subprocess
            result = subprocess.run(
                ['systemctl', 'is-active', service_name],
                capture_output=True,
                text=True
            )
            return result.stdout.strip() == 'active'
        except:
            return False
    
    def send_alert(self, alert_type, message):
        """å‘é€è­¦æŠ¥"""
        current_time = time.time()
        
        # æ£€æŸ¥å†·å´æ—¶é—´
        if alert_type in self.last_alerts:
            if current_time - self.last_alerts[alert_type] < self.alert_cooldown:
                return
        
        # å‘é€è­¦æŠ¥
        self.bot.send_alert(alert_type, message, 'warning')
        self.last_alerts[alert_type] = current_time
        self.logger.warning(f"Alert sent: {alert_type} - {message}")
    
    def monitor_loop(self):
        """ç›‘æ§ä¸»å¾ªç¯"""
        self.logger.info("ç³»ç»Ÿç›‘æ§å¯åŠ¨")
        
        while True:
            try:
                # æ£€æŸ¥ç³»ç»Ÿèµ„æº
                stats = self.check_system_resources()
                
                # CPUæ£€æŸ¥
                if stats['cpu'] > self.thresholds['cpu']:
                    self.send_alert(
                        'high_cpu',
                        f"CPUä½¿ç”¨ç‡è¿‡é«˜: {stats['cpu']:.1f}%"
                    )
                
                # å†…å­˜æ£€æŸ¥
                if stats['memory'] > self.thresholds['memory']:
                    self.send_alert(
                        'high_memory',
                        f"å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: {stats['memory']:.1f}%"
                    )
                
                # ç£ç›˜æ£€æŸ¥
                if stats['disk'] > self.thresholds['disk']:
                    self.send_alert(
                        'high_disk',
                        f"ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: {stats['disk']:.1f}%"
                    )
                
                # ç³»ç»Ÿè´Ÿè½½æ£€æŸ¥
                if stats['load'] > self.thresholds['load']:
                    self.send_alert(
                        'high_load',
                        f"ç³»ç»Ÿè´Ÿè½½è¿‡é«˜: {stats['load']:.2f}"
                    )
                
                # æ£€æŸ¥å…³é”®æœåŠ¡
                services = ['trading-system', 'trading-web', 'postgresql', 'nginx']
                for service in services:
                    if not self.check_service_status(service):
                        self.send_alert(
                            f'service_down',
                            f"æœåŠ¡ {service} å·²åœæ­¢"
                        )
                
                # è®°å½•ç»Ÿè®¡ä¿¡æ¯
                self.logger.info(
                    f"System stats - CPU: {stats['cpu']:.1f}%, "
                    f"Memory: {stats['memory']:.1f}%, "
                    f"Disk: {stats['disk']:.1f}%, "
                    f"Load: {stats['load']:.2f}"
                )
                
                # ç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥
                time.sleep(300)  # 5åˆ†é’Ÿ
                
            except Exception as e:
                self.logger.error(f"ç›‘æ§å¾ªç¯é”™è¯¯: {e}")
                time.sleep(60)

if __name__ == "__main__":
    from logging_config import setup_logging
    setup_logging()
    
    monitor = SystemMonitor()
    monitor.monitor_loop()
```

### 3. ç›‘æ§æœåŠ¡é…ç½®

åˆ›å»º `/etc/systemd/system/trading-monitor.service`ï¼š

```ini
[Unit]
Description=Trading System Monitor
After=network.target

[Service]
Type=simple
User=trading
Group=trading
WorkingDirectory=/home/trading/trading_system
Environment=PATH=/home/trading/trading_system/venv/bin
EnvironmentFile=/home/trading/trading_system/production.env
ExecStart=/home/trading/trading_system/venv/bin/python system_monitor.py
Restart=always
RestartSec=30

[Install]
WantedBy=multi-user.target
```

## ğŸ”„ å¤‡ä»½å’Œæ¢å¤

### 1. æ•°æ®åº“å¤‡ä»½è„šæœ¬

åˆ›å»º `backup_database.sh`ï¼š

```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬

BACKUP_DIR="/home/trading/trading_system/backups"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="trading_system"
DB_USER="trading_user"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# æ•°æ®åº“å¤‡ä»½
pg_dump -h localhost -U $DB_USER -d $DB_NAME > $BACKUP_DIR/db_backup_$DATE.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/db_backup_$DATE.sql

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "db_backup_*.sql.gz" -mtime +7 -delete

# å‘é€å¤‡ä»½å®Œæˆé€šçŸ¥
echo "æ•°æ®åº“å¤‡ä»½å®Œæˆ: db_backup_$DATE.sql.gz"
```

### 2. é…ç½®æ–‡ä»¶å¤‡ä»½

åˆ›å»º `backup_config.sh`ï¼š

```bash
#!/bin/bash
# é…ç½®æ–‡ä»¶å¤‡ä»½è„šæœ¬

BACKUP_DIR="/home/trading/trading_system/backups"
DATE=$(date +%Y%m%d_%H%M%S)
CONFIG_DIR="/home/trading/trading_system"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR/config

# å¤‡ä»½é…ç½®æ–‡ä»¶
cp $CONFIG_DIR/production.env $BACKUP_DIR/config/production.env_$DATE
cp $CONFIG_DIR/enhanced_config.py $BACKUP_DIR/config/enhanced_config.py_$DATE

# å¤‡ä»½ç³»ç»ŸæœåŠ¡æ–‡ä»¶
sudo cp /etc/systemd/system/trading-*.service $BACKUP_DIR/config/

# å¤‡ä»½Nginxé…ç½®
sudo cp /etc/nginx/sites-available/trading_system $BACKUP_DIR/config/nginx_$DATE

echo "é…ç½®æ–‡ä»¶å¤‡ä»½å®Œæˆ"
```

### 3. è‡ªåŠ¨å¤‡ä»½é…ç½®

æ·»åŠ åˆ°crontabï¼š
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½æ•°æ®åº“
0 2 * * * /home/trading/trading_system/backup_database.sh

# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹å¤‡ä»½é…ç½®æ–‡ä»¶
0 3 * * 0 /home/trading/trading_system/backup_config.sh
```

## ğŸ”§ è¿ç»´æ“ä½œ

### 1. å¸¸ç”¨è¿ç»´å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status trading-system
sudo systemctl status trading-web
sudo systemctl status trading-monitor

# é‡å¯æœåŠ¡
sudo systemctl restart trading-system
sudo systemctl restart trading-web

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u trading-system -f
tail -f /home/trading/trading_system/logs/trading_system.log

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop
df -h
free -h

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -tulpn | grep :5000

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep python
```

### 2. æ•…éšœæ’é™¤æµç¨‹

```bash
#!/bin/bash
# æ•…éšœæ’é™¤è„šæœ¬

echo "=== äº¤æ˜“ç³»ç»Ÿæ•…éšœæ’é™¤ ==="

# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "1. æ£€æŸ¥æœåŠ¡çŠ¶æ€..."
systemctl is-active trading-system
systemctl is-active trading-web
systemctl is-active postgresql
systemctl is-active nginx

# 2. æ£€æŸ¥ç«¯å£å ç”¨
echo "2. æ£€æŸ¥ç«¯å£å ç”¨..."
netstat -tulpn | grep :5000
netstat -tulpn | grep :5432

# 3. æ£€æŸ¥ç£ç›˜ç©ºé—´
echo "3. æ£€æŸ¥ç£ç›˜ç©ºé—´..."
df -h

# 4. æ£€æŸ¥å†…å­˜ä½¿ç”¨
echo "4. æ£€æŸ¥å†…å­˜ä½¿ç”¨..."
free -h

# 5. æ£€æŸ¥æœ€è¿‘çš„é”™è¯¯æ—¥å¿—
echo "5. æ£€æŸ¥æœ€è¿‘çš„é”™è¯¯æ—¥å¿—..."
tail -20 /home/trading/trading_system/logs/errors.log

# 6. æ£€æŸ¥æ•°æ®åº“è¿æ¥
echo "6. æ£€æŸ¥æ•°æ®åº“è¿æ¥..."
sudo -u postgres psql -c "SELECT version();"

# 7. æ£€æŸ¥ç½‘ç»œè¿æ¥
echo "7. æ£€æŸ¥ç½‘ç»œè¿æ¥..."
ping -c 3 api.binance.com
ping -c 3 api.telegram.org

echo "=== æ•…éšœæ’é™¤å®Œæˆ ==="
```

### 3. æ€§èƒ½ä¼˜åŒ–

```bash
#!/bin/bash
# æ€§èƒ½ä¼˜åŒ–è„šæœ¬

echo "=== ç³»ç»Ÿæ€§èƒ½ä¼˜åŒ– ==="

# 1. æ¸…ç†æ—¥å¿—æ–‡ä»¶
echo "1. æ¸…ç†æ—§æ—¥å¿—æ–‡ä»¶..."
find /home/trading/trading_system/logs -name "*.log.*" -mtime +30 -delete

# 2. æ¸…ç†ä¸´æ—¶æ–‡ä»¶
echo "2. æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
sudo apt autoremove -y
sudo apt autoclean

# 3. ä¼˜åŒ–æ•°æ®åº“
echo "3. ä¼˜åŒ–æ•°æ®åº“..."
sudo -u postgres psql trading_system -c "VACUUM ANALYZE;"

# 4. é‡å¯æœåŠ¡ï¼ˆå¯é€‰ï¼‰
read -p "æ˜¯å¦é‡å¯äº¤æ˜“æœåŠ¡ï¼Ÿ(y/N): " restart
if [[ $restart =~ ^[Yy]$ ]]; then
    sudo systemctl restart trading-system
    sudo systemctl restart trading-web
fi

echo "=== æ€§èƒ½ä¼˜åŒ–å®Œæˆ ==="
```

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å‰æ£€æŸ¥
- [ ] æœåŠ¡å™¨é…ç½®æ»¡è¶³è¦æ±‚
- [ ] åŸŸåDNSè§£ææ­£ç¡®
- [ ] SSLè¯ä¹¦å·²ç”³è¯·
- [ ] å¸å®‰APIå¯†é’¥å·²é…ç½®
- [ ] Telegram Botå·²åˆ›å»º
- [ ] æ•°æ®åº“å·²å®‰è£…é…ç½®

### éƒ¨ç½²åæ£€æŸ¥
- [ ] æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] Webç•Œé¢å¯æ­£å¸¸è®¿é—®
- [ ] Telegramé€šçŸ¥åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸
- [ ] ç›‘æ§ç³»ç»Ÿæ­£å¸¸
- [ ] å¤‡ä»½è„šæœ¬æ­£å¸¸
- [ ] é˜²ç«å¢™é…ç½®æ­£ç¡®

### å®‰å…¨æ£€æŸ¥
- [ ] é»˜è®¤å¯†ç å·²ä¿®æ”¹
- [ ] ä¸å¿…è¦çš„ç«¯å£å·²å…³é—­
- [ ] SSLè¯ä¹¦æœ‰æ•ˆ
- [ ] æ–‡ä»¶æƒé™æ­£ç¡®
- [ ] æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†
- [ ] è®¿é—®æ—¥å¿—å·²å¯ç”¨

## ğŸš¨ åº”æ€¥å“åº”

### 1. ç´§æ€¥åœæ­¢äº¤æ˜“

```bash
#!/bin/bash
# ç´§æ€¥åœæ­¢è„šæœ¬

echo "ğŸš¨ ç´§æ€¥åœæ­¢äº¤æ˜“ç³»ç»Ÿ..."

# åœæ­¢äº¤æ˜“æœåŠ¡
sudo systemctl stop trading-system

# å‘é€ç´§æ€¥é€šçŸ¥
curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
     -d "chat_id=$TELEGRAM_CHAT_ID" \
     -d "text=ğŸš¨ ç´§æ€¥åœæ­¢ï¼šäº¤æ˜“ç³»ç»Ÿå·²æ‰‹åŠ¨åœæ­¢"

echo "âœ… äº¤æ˜“ç³»ç»Ÿå·²åœæ­¢"
```

### 2. å¿«é€Ÿæ¢å¤

```bash
#!/bin/bash
# å¿«é€Ÿæ¢å¤è„šæœ¬

echo "ğŸ”„ å¿«é€Ÿæ¢å¤äº¤æ˜“ç³»ç»Ÿ..."

# æ£€æŸ¥æ•°æ®åº“
sudo systemctl start postgresql
sleep 5

# å¯åŠ¨äº¤æ˜“æœåŠ¡
sudo systemctl start trading-system
sudo systemctl start trading-web

# æ£€æŸ¥çŠ¶æ€
if systemctl is-active --quiet trading-system; then
    echo "âœ… äº¤æ˜“ç³»ç»Ÿæ¢å¤æˆåŠŸ"
    curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
         -d "chat_id=$TELEGRAM_CHAT_ID" \
         -d "text=âœ… æ¢å¤æˆåŠŸï¼šäº¤æ˜“ç³»ç»Ÿå·²é‡æ–°å¯åŠ¨"
else
    echo "âŒ äº¤æ˜“ç³»ç»Ÿæ¢å¤å¤±è´¥"
    curl -X POST "https://api.telegram.org/bot$TELEGRAM_BOT_TOKEN/sendMessage" \
         -d "chat_id=$TELEGRAM_CHAT_ID" \
         -d "text=âŒ æ¢å¤å¤±è´¥ï¼šäº¤æ˜“ç³»ç»Ÿå¯åŠ¨å¼‚å¸¸"
fi
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- **æŠ€æœ¯æ”¯æŒé‚®ç®±**: support@yourcompany.com
- **ç´§æ€¥è”ç³»ç”µè¯**: +86-xxx-xxxx-xxxx
- **Telegramç¾¤ç»„**: @your_trading_support

### å¸¸è§é—®é¢˜
1. **æœåŠ¡æ— æ³•å¯åŠ¨**: æ£€æŸ¥é…ç½®æ–‡ä»¶å’Œæ—¥å¿—
2. **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥æ•°æ®åº“æœåŠ¡å’Œè¿æ¥å‚æ•°
3. **Telegramé€šçŸ¥å¤±è´¥**: æ£€æŸ¥Bot Tokenå’ŒChat ID
4. **APIè°ƒç”¨å¤±è´¥**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPIå¯†é’¥

---

**æ³¨æ„**: æœ¬æŒ‡å—æä¾›äº†å®Œæ•´çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ–¹æ¡ˆï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é…ç½®å‚æ•°ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·åŠ¡å¿…è¿›è¡Œå……åˆ†çš„æµ‹è¯•ã€‚

